<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat</title>
</head>
<body>
    <h2>Selecciona una sala</h2>
    <form id="room-form">
        <input type="text" id="username" placeholder="Nombre">
        <select id="room-select">
            <!-- Opciones cargadas dinÃ¡micamente -->
        </select>
        <button type="submit">Entrar</button>
    </form>

    <div id="chat-area" style="display:none;">
        <h3>Chat</h3>
        <ul id="messages"></ul>
        <input type="text" id="message-input" placeholder="Mensaje">
        <button id="send-message">Enviar</button>
    </div>

    <script>
        const usernameInput = document.getElementById('username');
        const roomSelect = document.getElementById('room-select');
        const roomForm = document.getElementById('room-form');
        const chatArea = document.getElementById('chat-area');
        const messages = document.getElementById('messages');
        const messageInput = document.getElementById('message-input');
        const sendMessageButton = document.getElementById('send-message');
        let socket;

        // Cargar salas desde la API
        fetch('/api/rooms/')
            .then(response => response.json())
            .then(data => {
                data.forEach(room => {
                    const option = document.createElement('option');
                    option.value = room.name;
                    option.textContent = room.name;
                    roomSelect.appendChild(option);
                });
            });

        // Entrar a la sala
        roomForm.addEventListener('submit', event => {
            event.preventDefault();
            const username = usernameInput.value;
            const roomName = roomSelect.value;

            chatArea.style.display = 'block';
            roomForm.style.display = 'none';

            socket = new WebSocket(`ws://${window.location.host}/ws/chat/${roomName}/`);

            socket.onmessage = event => {
                const data = JSON.parse(event.data);
                const li = document.createElement('li');
                li.textContent = `${data.username}: ${data.message}`;
                messages.appendChild(li);
            };
        });

        // Enviar mensajes
        sendMessageButton.addEventListener('click', () => {
            const message = messageInput.value;
            socket.send(JSON.stringify({ username: usernameInput.value, message }));
            messageInput.value = '';
        });
    </script>
</body>
</html>
